*** Builder log created: {2021-05-29 23:46:53}
*** Builder log completed: {2021-05-29 23:47:21}

  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        https://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Stata license: Unlimited-user network, expiring 15 Apr 2022
Serial number: 401609206143
  Licensed to: Miika Päällysaho
               

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000; see help set_maxvar.

. do "source/estimation/ols_iv_estimates.do" 

. clear all

. set more off

. set gr off

. 
. local infolder  "input"

. local outfolder "build/estimation"

. 
. clear

. use `infolder'/qob1

. 
. label var earnwkl "Log Weekly Earnings"

. label var educ    "Years of Education"

. 
. qui tab qob, gen(qob)

. forvalues y=1(1)4 {
  2.   label var qob`y' "Born in Q`y'"
  3. }

. gen qob234 = qob1==0

. 
. * Replicate Table III, Panel B in Angrist & Kruger (QJE 1991)
. foreach var in earnwkl educ {
  2. 
.   qui sum    `var' if qob1==1
  3.   local mean_`var'_qob1     = r(mean)
  4.   local  obs_`var'_qob1     = r(N)
  5.   
.   qui sum    `var' if qob234==1
  6.   local mean_`var'_qob234   = r(mean)
  7.   local  obs_`var'_qob234   = r(N)
  8.   
.   qui reg    `var' qob234
  9.   local diff_`var'          = e(b)[1,1]
 10.   local diff_`var'_se       = sqrt(e(V)[1,1])
 11.   local diff_`var'_obs      = e(N)
 12. }

. 
. cap file close f

. file open   f using "`outfolder'/mean_earnings_schooling.txt", write replace
(note: file build/estimation/mean_earnings_schooling.txt not found)

. file write  f "<tab:mean_earnings_schooling>" _n

. file write  f  (`mean_earnwkl_qob1') _tab (`mean_earnwkl_qob234')  _tab  (`di
> ff_earnwkl')     _n

. file write  f  (`diff_earnwkl_se')   _n

. file write  f  (`mean_educ_qob1')    _tab (`mean_educ_qob234')     _tab  (`di
> ff_educ')        _n

. file write  f  (`diff_educ_se')      _n

. file write  f  (`obs_earnwkl_qob1')  _tab (`obs_earnwkl_qob234')   _tab  (`di
> ff_earnwkl_obs') _n

. file close  f

. 
. 
. qui reg earnwkl educ

. local ols_coef    = e(b)[1,1]

. local ols_se      = sqrt(e(V)[1,1])

. 
. qui ivregress 2sls earnwkl (educ=qob1)

. local wald_coef   = e(b)[1,1]

. local wald_se     = sqrt(e(V)[1,1])

. 
. qui reg educ qob1

. local first_coef  = e(b)[1,1]

. local first_se    = sqrt(e(V)[1,1])

. qui test qob1

. local wald_Fval   = r(F)

. 
. * Replicate Table V, Column (2) in Angrist & Kruger (QJE 1991)
. qui ivregress 2sls earnwkl i.yob (educ=i.yob#i.qob)

. local 2sls_coef   = e(b)[1,1]

. local 2sls_se     = sqrt(e(V)[1,1])

. qui estat first

. local 2sls_Fval   = r(mineig)

. qui estat overid

. local overid_chi2 = r(sargan)

. local overid_dof  = r(df)

. local overid_pval = r(p_sargan)

. 
. cap file close f

. file open   f using "`outfolder'/ols_iv_estimates.txt", write replace
(note: file build/estimation/ols_iv_estimates.txt not found)

. file write  f "<tab:ols_iv_estimates>" _n

. file write  f (`ols_coef')    _tab (`wald_coef')  _tab (`2sls_coef')  _n

. file write  f (`ols_se')      _tab (`wald_se')    _tab (`2sls_se')    _n

. file write  f (`first_coef')  _n

. file write  f (`first_se')    _n

. file write  f (`wald_Fval')   _tab (`2sls_Fval')  _n

. file write  f (`overid_chi2') _n

. file write  f (`overid_dof')  _n

. file write  f (`overid_pval') 

. file close  f

. 
. clear

. 
end of do-file
